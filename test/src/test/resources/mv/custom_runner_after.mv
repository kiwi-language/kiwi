import org.metavm.api.Index;

@Component
class Lab {

    public Lab() {}

    public any|null getFieldValue(Field field) {
        var fieldValue = FieldValue.fieldIdx.getFirst(field);
        if(fieldValue == null) {
            return null;
        }
        else {
            return fieldValue!!.getValue();
        }
    }

    public void setFieldValue(Field field, any|null value) {
        var fieldValue = FieldValue.fieldIdx.getFirst(field);
        if(fieldValue == null) {
            new FieldValue(field).setValue(value);
        }
        else {
            fieldValue!!.setValue(value);
        }
    }

}

class Field {

    private string name;
    private deleted any|null value;

    public Field(string name) {
        this.name = name;
    }

    public string getName() {
        return this.name;
    }

    public void setName(string name) {
        this.name = name;
    }

    public void __run__() {
        new FieldValue(this).setValue(this.value);
    }

}

record IdxFieldValueField {

    private readonly Field field;

    public IdxFieldValueField(Field field) {
        this.field = field;
    }

}

class FieldValue {


    private static Index<Field, FieldValue> fieldIdx;

    private static Index<Field, FieldValue> __fieldIdx__() {
        return new Index<Field, FieldValue>("fieldIdx", true, (FieldValue v) : Field -> {
            return v.getField();
        });
    }

    private readonly Field field;
    private any|null value;

    FieldValue(Field field) {
        this.field = field;
        this.value = null;
    }

    public any|null getValue() {
        return this.value;
    }

    public void setValue(any|null value) {
        this.value = value;
    }

    public Field getField() {
        return this.field;
    }

}