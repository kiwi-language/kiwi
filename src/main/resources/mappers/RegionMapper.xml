<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tech.metavm.infra.persistence.RegionMapper">

  <resultMap id="BaseResultMap" type="tech.metavm.infra.persistence.RegionPO">
    <!--@mbg.generated-->
    <!--@Table id_region-->
    <result property="typeCategory" jdbcType="INTEGER" column="type_category"/>
    <result property="start" jdbcType="BIGINT" column="start"/>
    <result property="end" jdbcType="BIGINT" column="end"/>
    <result property="next" jdbcType="BIGINT" column="next"/>
  </resultMap>

  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    type_category, `start`, `end`, `next`
  </sql>

  <select id="selectByTypeCategories" resultMap="BaseResultMap">
    <!--@mbg.generated-->
    select 
    <include refid="Base_Column_List"/>
    from id_region
    where type_category in
    <foreach collection="collection" item="typeCategory" separator="," open="(" close=")">
      #{typeCategory}
    </foreach>
    limit 1
    for update
  </select>

  <update id="inc">
    update id_region
    set
        `next` = `next` + #{inc}
    where type_category = #{typeCategory}
  </update>

  <insert id="batchInsert">
    <!--@mbg.generated-->
    insert into id_region (type_category, `start`, `end`, `next`) values
    <foreach collection="collection" item="item" separator=",">
      (
      #{item.typeCategory}, #{item.start}, #{item.end}, #{item.next}
      )
    </foreach>
  </insert>

</mapper>